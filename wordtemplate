import pandas as pd
from docx import Document
import os

# Load your Excel data
df = pd.read_excel("sample_case_data.xlsx")  # match your actual file name

# File paths
template_path = "research_template.docx"     # match your actual template file
output_dir = "GeneratedDocs"
os.makedirs(output_dir, exist_ok=True)

# Label-to-Excel field mapping
label_to_column = {
    "Case ID:": "CaseID",
    "Case Owner:": "CaseOwner",
    "Customer (Complainant) Name:": "CustomerName",
    "Customer Number (ECN):": "ECN",
    "Original Note Summary:": "OriginalNote",
    "Updated Note Summary:": "UpdatedNote",
    "Response Bullet List:": "ResponseBulletList"
}

def fill_labels_in_doc(doc, label_to_value):
    # Replace labels in paragraphs
    for para in doc.paragraphs:
        for label, value in label_to_value.items():
            if label in para.text:
                for run in para.runs:
                    if label in run.text:
                        run.text = run.text.replace(label, f"{label} {value}")

    # Replace labels inside table cells
    for table in doc.tables:
        for row in table.rows:
            for cell in row.cells:
                for para in cell.paragraphs:
                    for label, value in label_to_value.items():
                        if label in para.text:
                            for run in para.runs:
                                if label in run.text:
                                    run.text = run.text.replace(label, f"{label} {value}")

# Loop through Excel rows and generate a doc per case
for i, row in df.iterrows():
    doc = Document(template_path)
    
    # Build value map for this row
    label_to_value = {label: str(row[col]) for label, col in label_to_column.items()}
    
    fill_labels_in_doc(doc, label_to_value)
    
    output_file = os.path.join(output_dir, f"Case_{row['CaseID']}.docx")
    doc.save(output_file)

print("Documents created for all cases.")
