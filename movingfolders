# Define parameters
param (
    [string]$sourceBasePath = "C:\path\to\source\folders",
    [string]$destinationBasePath = "Z:\DMS",
    [string[]]$IDList = @("18275218_3763", "18275218_3764")  # List of mainfolder_subfolder IDs
)

# Create a log file
$logFile = "C:\path\to\logfile.log"
function Write-Log {
    param ([string]$message)
    Add-Content -Path $logFile -Value "$((Get-Date).ToString('yyyy-MM-dd HH:mm:ss')) - $message"
}

# Ensure the destination base path exists
if (-not (Test-Path -Path $destinationBasePath)) {
    New-Item -ItemType Directory -Path $destinationBasePath | Out-Null
    Write-Log "Created destination base path: $destinationBasePath"
}

# Function to copy files to DMS
function Copy-ToDMS {
    param (
        [string]$sourcePath,
        [string]$destinationPath
    )

    try {
        if (Test-Path -Path $sourcePath) {
            Write-Log "Copying files from $sourcePath to $destinationPath"
            Copy-Item -Path $sourcePath -Destination $destinationPath -Recurse -Force
            if ($?) {
                Write-Log "Copied files from $sourcePath to $destinationPath successfully"
            } else {
                Write-Log "Failed to copy items from $sourcePath to $destinationPath"
            }
        } else {
            Write-Log "Source path not found: $sourcePath"
        }
    } catch {
        Write-Log "Error copying files from $sourcePath to $destinationPath: $_"
    }
}

# Loop through each ID and copy the corresponding folders
foreach ($ID in $IDList) {
    $splitID = $ID -split '_'
    $mainFolder = $splitID[0]
    $subFolder = $splitID[1]

    $sourcePath = Join-Path -Path $sourceBasePath -ChildPath $mainFolder
    $destinationPath = Join-Path -Path $destinationBasePath -ChildPath $mainFolder

    if (-not (Test-Path -Path $destinationPath)) {
        New-Item -ItemType Directory -Path $destinationPath | Out-Null
        Write-Log "Created destination main folder: $destinationPath"
    }

    $sourceSubFolderPath = Join-Path -Path $sourcePath -ChildPath $subFolder
    $destinationSubFolderPath = Join-Path -Path $destinationPath -ChildPath $subFolder

    Copy-ToDMS -sourcePath $sourceSubFolderPath -destinationPath $destinationSubFolderPath
}

Write-Log "Script completed."
