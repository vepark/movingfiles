# Define parameters
param (
    [string]$BasePath = "",
    [string]$DestinationPath = "",
    [string]$IDList = ", , "  # List of mainfolder_subfolder combinations
)

# Function to log messages
function Log-Message {
    param (
        [string]$msg
    )
    Write-Host "$(Get-Date -Format "yyyy-MM-dd HH:mm:ss") - $msg"
}

# Function to copy subfolders to destination
function Copy-Subfolder {
    param (
        [string]$SourcePath,
        [string]$DestPath
    )
    Copy-Item -Path $SourcePath -Destination $DestPath -Recurse -Force
}

# Ensure the destination path exists
if (-not (Test-Path -Path $DestinationPath)) {
    New-Item -ItemType Directory -Path $DestinationPath | Out-Null
}

# Loop through each ID in the IDList
foreach ($ID in $IDList -split ',') {
    $ID = $ID.Trim()
    $IDs = $ID -split '_'
    $MainFolder = $IDs[0]
    $SubFolder = $IDs[1]

    $MainFolderPath = Join-Path -Path $BasePath -ChildPath $MainFolder
    $SubFolderPattern = "*$SubFolder*"

    if (Test-Path -Path $MainFolderPath) {
        $SubFolderPath = Get-ChildItem -Path $MainFolderPath -Recurse -Directory | Where-Object { $_.Name -like $SubFolderPattern }

        if ($SubFolderPath) {
            $DestSubPath = Join-Path -Path $DestinationPath -ChildPath "$MainFolder\$SubFolder"
            if (-not (Test-Path -Path $DestSubPath)) {
                New-Item -ItemType Directory -Path $DestSubPath | Out-Null
            }

            # Copy all contents of the subfolder directly into the destination folder
            Copy-Subfolder -SourcePath $SubFolderPath.FullName -DestPath $DestSubPath
            Log-Message "Copied $SubFolderPath to $DestSubPath"
        } else {
            Log-Message "Subfolder not found: $SubFolder in $MainFolderPath"
        }
    } else {
        Log-Message "Main folder path does not exist: $MainFolderPath"
    }
}

Log-Message "Script completed."










# Function to log messages
function Write-Log {
    param ([string]$message)
    $logFile = "C:\path\to\logfile.log"  # Update with the path to your log file
    Add-Content -Path $logFile -Value "$((Get-Date).ToString('yyyy-MM-dd HH:mm:ss')) - $message"
}

# Ensure the destination directory exists
if (-not (Test-Path -Path $DestinationDir)) {
    try {
        New-Item -ItemType Directory -Path $DestinationDir -Force | Out-Null
        Write-Log "Created destination directory: $DestinationDir"
    } catch {
        Write-Log "Error creating destination directory: $_"
        throw
    }
}

# Move entire folder to DMS
try {
    Write-Log "Moving files from $SourceDir to $DestinationDir"
    Move-Item -Path $SourceDir -Destination $DestinationDir -Recurse -Force
    Write-Log "Moved files from $SourceDir to $DestinationDir successfully"
} catch {
    Write-Log "Error moving files from $SourceDir to $DestinationDir: $($_)"
}
