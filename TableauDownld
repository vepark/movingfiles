import requests
import pandas as pd

# Step 1: Define the export URL
export_url = "https://.../export-crosstab-to-excel-server"  # Replace with actual URL

# Step 2: Add necessary headers (from Developer Tools > Headers)
headers = {
    "Cookie": "YOUR_COOKIE_STRING_HERE",  # Copy the full 'Cookie' string from Developer Tools
    "Content-Type": "application/json",   # Or "multipart/form-data" if applicable
    # Add any other required headers
}

# Step 3: Define the payload (from Developer Tools > Payload or Form Data)
payload = {
    "worksheet": "worksheet",  # Adjust key-value pairs based on your request
    "format": "excel"
}

# Step 4: Send the POST request
response = requests.post(export_url, headers=headers, json=payload)  # Use 'data=payload' if it's not JSON

if response.status_code == 200:
    # Step 5: Save the file as an Excel file
    with open("exported_crosstab.xlsx", "wb") as f:
        f.write(response.content)
    print("File downloaded successfully as 'exported_crosstab.xlsx'.")

    # Step 6: Load the Excel file into a Pandas DataFrame
    df = pd.read_excel("exported_crosstab.xlsx")
    print("Data successfully loaded into DataFrame!")

    # Optional: Display the DataFrame
    import ace_tools as tools
    tools.display_dataframe_to_user(name="Exported Crosstab Data", dataframe=df)

else:
    print(f"Failed to download file. HTTP Status Code: {response.status_code}")
    print("Response Text:", response.text)
